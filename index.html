<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0-M16 from src/site/xdoc/index.xml at 12 Feb 2024
 | Rendered using Apache Maven Fluido Skin 2.0.0-M8
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0-M16" />
    <meta name="author" content="The MyBatis Team" />
    <title>MyBatis Velocity â€“ MyBatis-Velocity</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-2.0.0-M8.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-2.0.0-M8.min.js"></script>
  </head>
  <body>
    <div class="container-fluid container-fluid-top">
      <header>
        <div id="banner">
          <div class="pull-left"></div>
          <div class="pull-right"><div id="bannerRight"><h1><a href="https://blog.mybatis.org/" class="externalLink"><img class="imageLink" src="https://www.mybatis.org/images/mybatis-logo.png" alt="MyBatis logo" /> MyBatis</a></h1></div></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 09 Dec 2022<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 2.1.3-SNAPSHOT</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Documentation</li>
    <li class="active"><a>Quick start</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html"><span class="icon-chevron-down"></span>Project Information</a>
     <ul class="nav nav-list">
      <li><a href="ci-management.html">CI Management</a></li>
      <li><a href="dependencies.html">Dependencies</a></li>
      <li><a href="dependency-info.html">Dependency Information</a></li>
      <li><a href="distribution-management.html">Distribution Management</a></li>
      <li class="active"><a>About</a></li>
      <li><a href="issue-management.html">Issue Management</a></li>
      <li><a href="licenses.html">Licenses</a></li>
      <li><a href="mailing-lists.html">Mailing Lists</a></li>
      <li><a href="plugin-management.html">Plugin Management</a></li>
      <li><a href="plugins.html">Plugins</a></li>
      <li><a href="scm.html">Source Code Management</a></li>
      <li><a href="summary.html">Summary</a></li>
      <li><a href="team.html">Team</a></li>
     </ul></li>
    <li><a href="project-reports.html"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="https://maven.apache.org/" class="builtBy" target="_blank"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn" class="span10">


  
    <section>
<h1>Introduction</h1>
      
<p>
      mybatis-velocity is an extension that allows you to use the Apache Velocity scripting language
      to generate your dynamic SQL queries on the fly.
      </p>
      
<p>
        If you are not familiar with apache velocity, you can learn it from its documentation site:
      </p>
      
<ul>
        
<li>
          <a href="https://velocity.apache.org/engine/2.1/vtl-reference.html" class="externalLink">Velocity Template Language (VTL) Reference</a>
        </li>
      </ul>
    </section>

    <section>
<h1>Requirments</h1>
      
<ul>
        
<li>Java : Java 8+</li>
        
<li>MyBatis : 3.5+</li>
        
<li>Velocity : 2.1+</li>
      </ul>
    </section>

    <section>
<h1>Install</h1>
      
<p>
        If you are using maven, you can add this:
      </p>
      
<div class="verbatim source"><pre class="prettyprint">
&lt;dependency&gt;
    &lt;groupId&gt;org.mybatis.scripting&lt;/groupId&gt;
    &lt;artifactId&gt;mybatis-velocity&lt;/artifactId&gt;
    &lt;version&gt;2.1.0&lt;/version&gt;
&lt;/dependency&gt;
</pre></div>

      
<p>If you are using gradle, you can use this snippet:</p>

      
<div class="verbatim source"><pre class="prettyprint">
dependencies {
    compile(&quot;org.mybatis.scripting:mybatis-velocity:2.1.0&quot;)
}</pre></div>

    </section>

    <section>
<h1>Configuration</h1>
      <section>
<h2>Common</h2>
        
<p>
          By default, the <code>mybatis-velocity.properties</code> file create in your classpath.
        </p>
        
<ul>
          
<li>
            You can specify user defined custom directives to use on the Velocity template engine using the Velocity standard property(<code>runtime.custom_directives</code>).
            For details see the <a href="#User_Defined_Directives">&quot;User Defined Directives&quot;</a>.
            
<div class="verbatim source"><pre class="prettyprint">
velocitySettings.runtime.custom_directives = com.example.directives.MyDirective
# or
runtime.custom_directives = com.example.directives.MyDirective
</pre></div>

            The <code>userdirective</code> property supported for keeping backward compatibility with old versions(2.0 or under).
            
<div class="verbatim source"><pre class="prettyprint">
userdirective = com.example.directives.MyDirective
</pre></div>
          </li>
          
<li>
            You can specify user defined additional context attribute values that passed to template engine.
            For details see the <a href="#Additional_Context_Attributes">&quot;Additional Context Attributes&quot;</a>.
            
<div class="verbatim source"><pre class="prettyprint">
# additionalContextAttributes.{name} = {value}
# 'additional-context-attributes' (kebab-case) can be used too
additionalContextAttributes.likeEscape = com.example.helpers.LikeEscape
additionalContextAttributes.masterCacheFacade = com.example.helpers.MasterCacheFacade
</pre></div>

            The <code>additional.context.attributes</code> property supported for keeping backward compatibility with old versions(2.0 or under).
            
<div class="verbatim source"><pre class="prettyprint">
# Value format: {name}:{value}(,...)
additional.context.attributes = likeEscape:com.example.helpers.LikeEscape,masterCacheFacade:com.example.helpers.MasterCacheFacade
</pre></div>
          </li>
          
<li>
            You can configure the Velocity configuration as follow:
            About available setting name, please refer to <a href="https://velocity.apache.org/engine/2.1/configuration.html" class="externalLink">the reference documentation of Velocity</a>.
            
<div class="verbatim source"><pre class="prettyprint">
# velocitySettings.{name} = {value}
# 'velocity-settings' (kebab-case) can be used too
velocitySettings.resource.default_encoding = Windows-31J
</pre></div>

            The <code>{name} = {value}</code> format(without prefixed 'velocitySettings') supported for keeping backward compatibility with old versions(2.0 or under).
            
<div class="verbatim source"><pre class="prettyprint">
# This setting is same with 'velocitySettings.resource.default_encoding'
resource.default_encoding = Windows-31J
</pre></div>
          </li>
          
<li>
            Since 2.1.0, you can use an any properties file or encoding as follow:
            
<div class="verbatim source"><pre class="prettyprint">
$ java -Dmybatis-velocity.config.file=mybatis-velocity_production.properties -Dmybatis-velocity.config.encoding=Windows-31J ...
</pre></div>
          </li>
        </ul>

      </section>
      <section>
<h2>Scripting Language Driver</h2>
        
<p>
          You may need to do next steps:</p>
        
<ul>
          
<li>Register the language driver alias in your mybatis configuration file:
            
<div class="verbatim source"><pre class="prettyprint">
&lt;configuration&gt;
  ...
  &lt;typeAliases&gt;
    &lt;typeAlias alias=&quot;velocity&quot; type=&quot;org.mybatis.scripting.velocity.VelocityLanguageDriver&quot;/&gt;
  &lt;/typeAliases&gt;
  ...
&lt;/configuration&gt;</pre></div>
          </li>
          
<li>Set the velocity as your default scripting language:
            
<div class="verbatim source"><pre class="prettyprint">
&lt;configuration&gt;
  ...
  &lt;settings&gt;
      &lt;setting name=&quot;defaultScriptingLanguage&quot; value=&quot;velocity&quot;/&gt;
  &lt;/settings&gt;
  ...
&lt;/configuration&gt;</pre></div>
          </li>
        </ul>
      </section>
    </section>

    <section>
<h1>Usage</h1>
      
<p>Just write your dynamic queries and use velocity:</p>
      
<p>Example:
      </p>
<div class="verbatim source"><pre class="prettyprint">
&lt;select id=&quot;findPerson&quot; lang=&quot;velocity&quot;&gt;
  #set( $pattern = $_parameter.name + '%' )
  SELECT *
  FROM person
  WHERE name LIKE @{pattern, jdbcType=VARCHAR}
&lt;/select&gt;
      </pre></div>
      
      
<p>
        Note:
      </p>
      
<ul>
        
<li><code>#{...}</code> syntax is replaced by <code>@{...}</code> syntax to avoid collisions with VTL</li>
      </ul>
    </section>
    <section>
<h1>Custom directives</h1>
      <section>
<h2>trim</h2>
        <section><section><section>
<h5>#trim( prefix prefixOverrides suffix suffixOverrides ) body #end</h5>
        
<table class="table table-striped">
          <thead>
            
<tr class="a">
              
<th>Arg</th>
              
<th>Description</th>
              
<th>Type</th>
              
<th>Default</th>
              
<th>Example</th>
            </tr>
          </thead>
          <tbody>
            
<tr class="b">
              
<td>prefix</td>
              
<td>Text to prepend if the body is not empty</td>
              
<td>String</td>
              
<td>Empty String</td>
              
<td>&quot;WHERE &quot;</td>
            </tr>
            
<tr class="a">
              
<td>prefixOverrides</td>
              
<td>Text to be removed from the body if it is at the beginning</td>
              
<td>String list delimited by |</td>
              
<td>Empty String</td>
              
<td>&quot;AND |OR &quot;</td>
            </tr>
            
<tr class="b">
              
<td>suffix</td>
              
<td>Text to appended if the body is not empty</td>
              
<td>String</td>
              
<td>Empty String</td>
              
<td>&quot;] &quot;</td>
            </tr>
            
<tr class="a">
              
<td>suffixOverrides</td>
              
<td>Text to be removed from the body if it is at the end</td>
              
<td>String list delimited by |</td>
              
<td>Empty String</td>
              
<td>&quot;,&quot;</td>
            </tr>
          </tbody>
        </table>
      </section></section></section></section>
      <section>
<h2>where</h2>
        <section><section><section>
<h5>#where() body #end</h5>
        
<p>Removes any AND or OR from the beginning, then if the result is not empty, prepends WHERE at the beginning</p>
      </section></section></section></section>
      <section>
<h2>mset</h2>
        <section><section><section>
<h5>#mset() body #end</h5>
        
<p>Removes any &quot;,&quot; from the end, then if the result is not empty, prepends SET at the beginning</p>
      </section></section></section></section>
      <section>
<h2>repeat</h2>
        <section><section><section>
<h5>#repeat( collection  var  separator  open  close ) body #end</h5>
        
<p>
          Same as #foreach, but with special features:
        </p>
        
<ul>
          
<li>Support for iterative parameter bindings via @{...} syntax</li>
          
<li>Automatic separator and open/close string management</li>
        </ul>
        
<table class="table table-striped">
          <thead>
            
<tr class="a">
              
<th>Arg</th>
              
<th>Description</th>
              
<th>Type</th>
              
<th>Default</th>
              
<th>Example</th>
            </tr>
          </thead>
          <tbody>
            
<tr class="b">
              
<td>collection</td>
              
<td>List or array to iterate</td>
              
<td>List or Array</td>
              
<td>Empty List</td>
              
<td>$_parameter.selectedIds</td>
            </tr>
            
<tr class="a">
              
<td>var</td>
              
<td>Variable to be used in the loop</td>
              
<td>Reference</td>
              
<td></td>
              
<td>$item</td>
            </tr>
            
<tr class="b">
              
<td>separator</td>
              
<td>String to be inserted between iterations</td>
              
<td>String</td>
              
<td>Empty String</td>
              
<td>&quot;,&quot;</td>
            </tr>
            
<tr class="a">
              
<td>open</td>
              
<td>String to be prepended at the beginning</td>
              
<td>String</td>
              
<td>Empty String</td>
              
<td>&quot;(&quot;</td>
            </tr>
            
<tr class="b">
              
<td>close</td>
              
<td>String to be appended at the end</td>
              
<td>String</td>
              
<td>Empty String</td>
              
<td>&quot;)&quot;</td>
            </tr>
          </tbody>
        </table>
        
<p>Example:</p>
        
<div class="verbatim source"><pre class="prettyprint">
SELECT *
FROM City
#where()
  #repeat( $_parameter.ids $id &quot;,&quot; &quot; state_id IN (&quot; &quot;)&quot; )
    @{id}
  #end
#end
        </pre></div>
      </section></section></section></section>
      <section>
<h2>in</h2>
        <section><section><section>
<h5>#in( collection  var  field ) body #end</h5>
        
<p>
          Generates a SQL IN clause and breaks it into groups of 1000 items seperated by an OR clause to get around database limitations on the maximum number of items that can be handled.
          It also supports iterative parameter bindings via @{...} syntax.
        </p>
        
<table class="table table-striped">
          <thead>
            
<tr class="a">
              
<th>Arg</th>
              
<th>Description</th>
              
<th>Type</th>
              
<th>Default</th>
              
<th>Example</th>
            </tr>
          </thead>
          <tbody>
            
<tr class="b">
              
<td>collection</td>
              
<td>List or array to iterate</td>
              
<td>List or Array</td>
              
<td>Empty List</td>
              
<td>$_parameter.selectedIds</td>
            </tr>
            
<tr class="a">
              
<td>var</td>
              
<td>Variable to be used in the loop</td>
              
<td>Reference</td>
              
<td></td>
              
<td>$item</td>
            </tr>
            
<tr class="b">
              
<td>field</td>
              
<td>Field name to be inserted before the IN clause</td>
              
<td>String</td>
              
<td>Empty String</td>
              
<td>&quot;state_id&quot;</td>
            </tr>
          </tbody>
        </table>
        
<p>Example:</p>
        
<div class="verbatim source"><pre class="prettyprint">
SELECT *
FROM City
#where()
  #in( $_parameter.ids $id &quot;state_id&quot; )
    @{id}
  #end
#end
        </pre></div>
      </section></section></section></section>
    </section>
    <section>
<h1>User Defined Directives</h1>
      
<p>
      mybatis-velocity allows you to write your own velocity directive:
      </p>
        
<ul>
          
<li>
            Create a property file named <code>mybatis-velocity.properties</code> and put in on the classpath.
          </li>
          
<li>
             Create your own velocity directive.
          </li>
          
<li>
             Add the directive to the property file.
          </li>
         
<li>
             Use the directive in the sql template.
            <br />
          </li>
        </ul>
        
<p>Example:</p>

        
<div class="verbatim source"><pre class="prettyprint">
// User defined directive
package com.example.directives;

public class MyDirective extends Directive {
  // ...
}
</pre></div>

      
<div class="verbatim source"><pre class="prettyprint">
# mybatis-velocity.properties
userdirective=com.example.directives.MyDirective,com.example.directives.SpecialDirective
</pre></div>

      
<div class="verbatim source"><pre class="prettyprint">
&lt;!-- sql template --&gt;
SELECT *
FROM City
  #myDirective()
    ......
  #end
</pre></div>

    </section>

    <section>
<h1>Additional Context Attributes</h1>
      
<p>
        The mybatis-velocity allows you to pass any attribute(instantiate using specified FQCN) to the Velocity template engine.
      </p>
      
<ul>
        
<li>
          Create a property file named <code>mybatis-velocity.properties</code> and put in on the classpath.
        </li>
        
<li>
          Create any <b>thread safe</b> class.
        </li>
        
<li>
          Add the class to the property file.
        </li>
        
<li>
          Use object that instantiated by mybatis-velocity in your sql template.
        </li>
      </ul>
      
<p>Example:</p>

      
<div class="verbatim source"><pre class="prettyprint">
// User defined directive
package com.example.helpers;

public class LikeEscape {
  public String escape(String val) {
    // ...
    return escapedVal;
  }
}
</pre></div>

      
<div class="verbatim source"><pre class="prettyprint">
# mybatis-velocity.properties
additionalContextAttributes.likeEscape = com.example.helpers.LikeEscape
</pre></div>

      
<div class="verbatim source"><pre class="prettyprint">
&lt;!-- sql template --&gt;
#set( $pattern = $likeEscape.escape($_parameter.name) + &quot;%&quot; )
SELECT * FROM User
  WHERE name LIKE @{pattern, javaType=string}
</pre></div>
    </section>

    <section>
<h1>MyBatis specific syntax</h1>
      <section>
<h2>Parameter Bindings</h2>
        
<p><code>@{ property, attr1=val1, attr2=val2, ... }</code></p>
        
<p>Where attrs must be any of: javaType, jdbcType, mode, numericScale, resultMap, typeHandler, jdbcTypeName</p>
      </section>
    </section>
  


        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Â©      2012â€“2024
<a href="https://www.mybatis.org/">MyBatis.org</a>
</p>
        </div>
      </div>
    </footer>
<script>
  if(anchors) {
    anchors.add();
  }
</script>
  </body>
</html>
